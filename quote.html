<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get a Quote - Indy Expedited</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 40px;
        }
        .container {
            display: inline-block;
            text-align: left;
        }
        input, button {
            display: block;
            margin: 10px 0;
            width: 300px;
            padding: 8px;
        }
        .back-btn {
            background-color: #b30000;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Get a Quote</h1>
    <div class="container">
        <label>Pickup Location:</label>
        <input id="pickup" type="text" placeholder="Enter pickup address">

        <label>Stops:</label>
        <div id="stops"></div>
        <button onclick="addStop()">+ Add Stop</button>

        <label>Drop-off Location:</label>
        <input id="dropoff" type="text" placeholder="Enter drop-off address">

        <button onclick="calculateQuote()">Calculate Quote</button>

        <p id="result"></p>
        <p>* $40 minimum to book *</p>
        <button class="back-btn" onclick="window.location.href='index.html'">Back to Home</button>
    </div>

    <script>
        function addStop() {
            const stopInput = document.createElement("input");
            stopInput.type = "text";
            stopInput.placeholder = "Enter stop address";
            stopInput.className = "stop";
            document.getElementById("stops").appendChild(stopInput);
            new google.maps.places.Autocomplete(stopInput);
        }

        function calculateQuote() {
            const pickup = document.getElementById("pickup").value;
            const dropoff = document.getElementById("dropoff").value;
            const stops = Array.from(document.getElementsByClassName("stop")).map(input => input.value);

            if (!pickup || !dropoff) {
                document.getElementById("result").innerText = "Please enter pickup and drop-off locations.";
                return;
            }

            const service = new google.maps.DistanceMatrixService();
            const allStops = [...stops, dropoff];

            service.getDistanceMatrix({
                origins: [pickup],
                destinations: allStops,
                travelMode: 'DRIVING',
                unitSystem: google.maps.UnitSystem.IMPERIAL,
            }, function(response, status) {
                if (status !== 'OK') {
                    document.getElementById("result").innerText = "Error calculating distance.";
                } else {
                    let totalMiles = 0;
                    response.rows[0].elements.forEach(elem => {
                        if (elem.status === "OK") {
                            const miles = elem.distance.text.replace(' mi', '');
                            totalMiles += parseFloat(miles);
                        }
                    });
                    let quote = totalMiles * 1.25;
                    if (quote < 40) quote = 40;
                    document.getElementById("result").innerText = `Estimated Quote: $${quote.toFixed(2)}`;
                }
            });
        }

        function initAutocomplete() {
            new google.maps.places.Autocomplete(document.getElementById("pickup"));
            new google.maps.places.Autocomplete(document.getElementById("dropoff"));
        }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxG_4lz6oOgFbOlPtSO_mVOQyCSjgRWWw&libraries=places&callback=initAutocomplete" async defer></script>
</body>
</html>
